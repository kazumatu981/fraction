# [演習]分数の四則演算ができるライブラリの提供

## 演習概要

分数の四則演算ができるようになるライブラリを開発します。
例えば、以下のコードは `1/2 + 1/3 = 5/6` を表すソースコードです。

```ts
import { Fraction } from 'fraction';

// 1/2 を表すオブジェクト
const f1 = new Fraction(1, 2);
// 1/3 を表すオブジェクト
const f2 = new Fraction(1, 3);

// 1/2 + 1/3 を計算する
const result = f1.add(f2);

console.log(result.toString()); // 5/6
```

一般的なプログラミング言語で準備されている型は、整数か小数しか表せません。
従いまして、多くのプログラミング言語では、 `1/3 * 3` の答えは`0.99999999999`になり、
小学校で習った `1` と異なります。
このような状態を、「プログラマは仕様なので仕方がない」という逃げ口上で逃げてきたのですが、
今回はあえてその課題にチャレンジしましょう。

意外と道のりは長くて、小学校を振り返ると。。。。

1. 最大公約数や最小公倍数を見つけないといけません。
2. そのためには、素因数分解ができないといけないですね。
3. あれ素数ってどうやって求めるんでしたっけ？？？？

となります。

小学校の算数の知識とプログラミングセンスがあれば、そこまで難しくはないのですが。。。。。

今回は、**プロフェッショナルなプログラマがどのようにして品質を担保しているか** を一部体験することも目的のひとつです。
コード編集環境やテスト環境、モジュール設計、バグ対策などいろいろと仕掛をしています。それらをステップバイステップで学んでいきましょう。

## 演習

いきなりやろうと思うと大変なので、順に理解していくことから始めます。

### [step1] プロジェクトの理解

1. [演習の基礎知識](./0.演習の基礎知識.md) を見ながらあなたの環境を確認してください。
2. [仕様書](../api/index.md)を確認して、どんな仕様のものかを再確認します。

仕様書はとても細かいことが書いてあるので、実装しながらじっくり確認していっても構いません。
まずは概要を理解しましょう。

### [step2] 共通課題の取り組み

[共通課題](./2.共通課題.md) をみんなで一緒に解決しよう

### [step3] 担当課題の取り組み

[担当課題](./3.担当課題.md)についてグループ内で担当者を決めて解決していこう。

| 課題ID | タイトル | 課題概要 | 難易度 |
| ------ | -------- | -------- | ------ |
| SPF001 | `add`/`subtract`/`multiply`/`divide`のテストを完成させよう | 四則演算メソッドのテストケースを追加・完成させる | 低 |
| SPF002 | `add`/`subtract`/`multiply`/`divide`の実装を完成させよう | 四則演算メソッドの実装を完成させる | 低 |
| SPF003 | [チャレンジ課題]: 関数のオーバライド | 分数に整数を加減乗除できるように関数の引数型を拡張する | 中 |
| SPF004 | [チャレンジ課題]: 小数→分数をできるようにしよう | 小数から分数インスタンスを生成できるようにする | 高 |
| SPN001 | `extractPrimeFactors()` のテストケースを追加実装しよう | 素因数分解のテストケースを完成させる | 低 |
| SPN002 | `resolveGcd()`/`resolveLcm()` のテストを完成させよう | 最大公約数・最小公倍数のテストケースを完成させる | 低 |
| SPN004 | `resolveGcd()`/`resolveLcm()` を実装しよう | 最大公約数・最小公倍数の計算ロジックを実装する | 中 |
| SPN005 | [チャレンジ課題]: コードのリファクタリング | 高階関数（map/reduce）を使った素因数分解のリファクタリングと考察 | 高 |

### [step4] プロジェクトの総仕上げ

プロジェクトの仕上げとして、組み合わせテストを実装します。
モジュール `Fraction` と `Numerics`で公開されている関数やクラスの基本機能について、テストするテストコードを追記してください。

`__tests__/combination-test/combination.fraction.test.ts`と `__tests__/combination-test/combination.numerics.test.ts`を完成させてください。

### [step5] バグ対策 [上級]

ところが、テストは失敗するはずです。
このプロジェクトには決定的なバグがあります。

`prime-number-table.ts`の担当者は、**`1` が素数である** という勘違いをしていました。
19世紀前半の書物には確かに **`1` が素数である** という記載がありました。
しかし、現在の数学では **`1` を素数から除外するのが一般的** で、さらに高度な抽象代数学の議論から見ても、
**`1` は素数ではありません。**

この結果、どういう現象が発生するかをソースコードから推測してください。
どこでどのようなことが発生するかを説明してください。

そのうえで、**素数テーブルの1を素数ではなくする** 対策とすべきか、**`1`を素数として扱うが問題の現象が発生しなくなるようにする** 対策をとるべきかを検討してください。
この検討結果を、「現象」「原因」「対策」と章立てをしてドキュメントにまとめましょう。
`/docs/issues/issue001.md`にまとめてください。
そこにまとめた内容に従って、対策を取ってください。

対策後、組み合わせテストまで含めてテスト実行できることを確認してください。

### [step6] 素数テーブルの効率向上 [チャレンジ]

素数テーブルは、現在キャッシュしている最大値を超えるたびにクリアして作り直しています。
このような処理だと、メモリが分断化されて非常に効率が悪くなりがちです。
巧く拡張していくような方法はないかを検討してみましょう。
